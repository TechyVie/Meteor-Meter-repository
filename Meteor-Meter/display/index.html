<!DOCTYPE html>
<html>
<head>
    <title>Meteor Meter</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <button id="openModalBtn" class="hamburger-btn" aria-label="Open details menu">
      <span class="bar"></span>
      <span class="bar"></span>
      <span class="bar"></span>
    </button>

    <div id="myModal" class="modal">
      <div class="modal-content" id="modalContent">
        <span class="close" id="closeModalBtn">&times;</span>
        <h2>Simulation Details</h2>
        <p>This modal can expand to show more info!</p>
        <button id="expandBtn" class="expand-btn">
          <span class="expand-icon">&#9660;</span> Expand
        </button>
        <div id="extraContent">
          <p><strong>Additional Information</strong><br></p>
          <p><b>Eccentricity</b><br>
          The eccentricity of an orbit refers to how circular an orbit is.<br> </p>
          <p><b>Impact Energy</b><br>
          The energy generated by the meteor after it hits the ground of a planet.</p>
          <p><b>Meteor</b><br>
          When meteoroids(space rocks that range in size) enter the Earth's atmosphere, 
          or another planet's, they are called meteors. <br> </p>
          <p><b>Meteorites</b><br>
          When a meteor survives its trip through the atmosphere and hits the ground,
          we refer to them as meteorites, which ranges from the size of a pebble to a fist.<br> </p>
          <p><strong>Near-Earth Objects</strong> <br>
          Are any comets or asteroids orbitting near or around Earth with the possibility of entering Earth's 
          atmosphere.<br> </p>
          <p><strong>Did you Know?</strong> <br><br>
          -More than 50,000 meteorites have been found on Earth and 99.8% of them came from asteroids.<br><br>
          -There are three major types of meteorites:"irons", "stony", and "stony-irons".<br><br>
          -A total of 190 impact craters are found on the surface of Earth.<br>
          </p>
          <P><strong>Meteor in History</strong><br>
          The meteor that caused the fifth mass extinction that wiped out 75% of land and marine animals on Earth
          65 million years ago is named Chicxulub. This meteor produced the 300-km-wide Chicxulub crater in Mexico.
          While a lot of animals died on the impact, the succeeding disasters created by the meteor, a mile-high tsunami,
          acid rain, global firestorm, and global cooling, were the reason for the majority of the extinction.<br>
          </P> 
          <a href="https://science.nasa.gov/solar-system/meteors-meteorites/facts/">Reference</a>
        </div>
      </div>
    </div>

    <div class="container wide">
        <h1>Meteor Meter</h1>
        <div id="map-container"></div>
        <div class="coords">
            <p><i>Click a point on the map to automatically get the latitude and longitude.</i></p>
            <div class="coords-oval">
                <div class="coord-row">
                    <label for="latitude">Impact Latitude:</label>
                    <input id="latitude" type="number" step="0.0001" placeholder="e.g. 34.0522">
                </div>
                <div class="coord-row">
                    <label for="longitude">Impact Longitude:</label>
                    <input id="longitude" type="number" step="0.0001" placeholder="e.g. -118.2437">
                </div>
                <div class="coord-row">
                    <label for="diameter">Meteor Diameter(in km):</label>
                    <input id="diameter" type="number" step="0.01" placeholder="e.g. 10.5">
                </div>
                <div class="coord-row">
                    <label for="speed">Meteor Speed(in km/h):</label>
                    <input id="speed" type="number" step="0.01" placeholder="e.g. 20.2">
                </div>
            </div>
            <span class="impact-label" id="impact-status"></span>
        </div>
        <div class="actions">
            <button id="calc-btn" type="button">Simulate Meteor Impact</button>
        </div>
    </div>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/topojson-client@3"></script>
    <script>
      const width = Math.max(document.getElementById('map-container').offsetWidth, 900);
      const height = 500;

      const svg = d3.select("#map-container")
        .append("svg")
        .attr("width", width)
        .attr("height", height)
        .style("cursor", "crosshair");

      svg.append("rect")
        .attr("class", "water")
        .attr("x", 0)
        .attr("y", 0)
        .attr("width", width)
        .attr("height", height);

      const projection = d3.geoEquirectangular()
        .scale(width / 7.5)
        .translate([width / 2, height / 2]);

      const path = d3.geoPath().projection(projection);
      const g = svg.append("g");

      d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json").then(function(world) {
        const countries = topojson.feature(world, world.objects.countries).features;
        g.selectAll("path")
          .data(countries)
          .enter().append("path")
          .attr("class", "land")
          .attr("d", path);
      });

      let currentZoom = 1; 

      const zoom = d3.zoom()
        .scaleExtent([1, 10])
        .on("zoom", function(event) {
          currentZoom = event.transform.k;
          g.attr("transform", event.transform);
          g.selectAll(".pin")
            .attr("r", 8 / currentZoom);
        });

      svg.call(zoom);

      svg.on("click", function(event) {
        const transform = d3.zoomTransform(svg.node());
        const [x, y] = d3.pointer(event, svg.node());
        const invX = (x - transform.x) / transform.k;
        const invY = (y - transform.y) / transform.k;
        let coords = projection.invert([invX, invY]);
        if (!coords) return;
        const [lon, lat] = coords;

        svg.selectAll(".pin").remove();

        g.append("circle")
          .attr("class", "pin")
          .attr("cx", invX)
          .attr("cy", invY)
          .attr("r", 8 / currentZoom) 
          .attr("fill", "#c21807")
          .attr("stroke", "#fff")
          .attr("stroke-width", 2);

        document.getElementById('latitude').value = lat.toFixed(4);
        document.getElementById('longitude').value = lon.toFixed(4);
      });

      document.getElementById('calc-btn').onclick = function() {
        const lat = parseFloat(document.getElementById('latitude').value);
        const lon = parseFloat(document.getElementById('longitude').value);
        const dia = parseFloat(document.getElementById('diameter').value);
        const speed = parseFloat(document.getElementById('speed').value);

        if(isNaN(lat) || isNaN(lon) || isNaN(dia) || isNaN(speed)) {
          document.getElementById('impact-status').textContent = 'Please fill all fields with valid numbers.';
          return;
        }
        const damageRadius = Math.round((dia * speed) / 55 * 100) / 100;
        let severity = 'Minor';
        if(damageRadius > 2) severity = 'Severe';
        else if(damageRadius > 1) severity = 'Moderate';
        document.getElementById('impact-status').textContent =
          `Impact Detected: ${severity} damage radius ${damageRadius} km`;
      };

      document.getElementById('openModalBtn').onclick = function() {
        document.getElementById('myModal').style.display = 'block';
      };
      document.getElementById('closeModalBtn').onclick = function() {
        document.getElementById('myModal').style.display = 'none';
      };
      window.onclick = function(event) {
        if (event.target === document.getElementById('myModal')) {
          document.getElementById('myModal').style.display = 'none';
        }
      };
      document.getElementById('extraContent').style.display = 'none'; 
      document.getElementById('expandBtn').onclick = function() {
        var content = document.getElementById('extraContent');
        var icon = this.querySelector('.expand-icon');
        if (content.style.display === 'block') {
          content.style.display = 'none';
          if (icon) icon.innerHTML = '&#9660;';
        } else {
          content.style.display = 'block';
          if (icon) icon.innerHTML = '&#9650;';
        }
      };
    </script>
</body>
</html>
